services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: blacknode-backend:latest
    restart: unless-stopped
    environment:
      - spring.profiles.active=dev
      - JWT_EXPIRATION_TIME=${JWT_EXPIRATION_TIME}
      - APPLICATION_URL=${APPLICATION_URL:http://localhost}
    expose:
      - "8080"
    healthcheck:
      test: >
        CMD-SHELL
        curl -fs http://localhost:8080/api/health
        | grep -q '"status":"SUCCESS"'
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: blacknode-frontend:latest
    expose:
      - "80"
    restart: unless-stopped

  proxy:
    build:
      context: ./proxy
      dockerfile: Dockerfile
    image: blacknode-proxy:latest
    depends_on:
      - backend
    ports:
      - "80:80"
    restart: unless-stopped

